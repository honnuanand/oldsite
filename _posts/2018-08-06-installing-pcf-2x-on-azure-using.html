---
layout: post
title: 'Installing PCF 2.X  on Azure using Concourse - Part - 3 , Installing Pivotal
  Cloud Foundry using a Pipeline '
date: '2018-08-06T00:04:00.000-07:00'
author: Anand Rao
tags: 
modified_time: '2018-08-09T23:26:23.543-07:00'
thumbnail: https://1.bp.blogspot.com/-i_vi5unNniE/W2flrOu0gLI/AAAAAAAAGLE/UcMHWclSDZU86xE-Xv8m4gDw-QPkbmIzQCLcBGAs/s72-c/pcf-1.png
blogger_id: tag:blogger.com,1999:blog-3696969976504014907.post-5174111769903376951
blogger_orig_url: https://blog.clue2solve.io/2018/08/installing-pcf-2x-on-azure-using.html
---

In the First two parts of this series ,&nbsp; We talked about installing BBL , bosh and concourse. Lets dive right into the main course :) .. Pivotal Cloud Foundry ( PCF)&nbsp; using the platform automation pipelines also called PCF Pipelines. ( Links to individual posts are at the bottom)<br /><br />I would download&nbsp;<a href="https://network.pivotal.io/products/pcf-automation" target="_blank">Pcf-Pileines from the pivotal network</a>&nbsp;which is a tested and curated version.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-i_vi5unNniE/W2flrOu0gLI/AAAAAAAAGLE/UcMHWclSDZU86xE-Xv8m4gDw-QPkbmIzQCLcBGAs/s1600/pcf-1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="960" data-original-width="1600" height="237" src="https://1.bp.blogspot.com/-i_vi5unNniE/W2flrOu0gLI/AAAAAAAAGLE/UcMHWclSDZU86xE-Xv8m4gDw-QPkbmIzQCLcBGAs/s400/pcf-1.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both;">Once you download the tar.gz file from pivnet, you should extract the compressed file. Out Focus will be the folder called "<b>install-pcf/azure</b>" folder on the main path.&nbsp;</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;">You will need to edit the params.yml file on that path. I would suggest using the sample from my&nbsp;<a href="https://gist.github.com/honnuanand/0b0f5aefef64136658b5481d66b3ad22" target="_blank">sample here</a>&nbsp;as a starting point.&nbsp;&nbsp;</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;">You will need to do some Azure Setup needed before you can upload and kick off the pipeline. This is focussed on creation of the storage account and containers for the terraform state to be stored. Remember,&nbsp; the pipelines use terraform to create the initial infrastructure aka.. Ops manager etc ..&nbsp;</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;">The best place to do this will be the Azure cloud shell.&nbsp; Login to the Azure portal click on the cloud shell button.&nbsp; Once in the Cloud Shell ,&nbsp; you will need to:</div><div class="separator" style="clear: both;"></div><ul><li>Create a new Resource Group to store the terraform files&nbsp;</li><li>Create a new Storage account in that resource group</li><li>Create a container inside using that storage account&nbsp;</li></ul><div>Have a look at&nbsp;<a href="https://gist.github.com/honnuanand/6c62f8e13f1134da9b0432d0750347fc" target="_blank">my example on the Gist</a>. Once you are done with this ,&nbsp; open the portal and make your way to the container that you just created and copy one of the keys to that container.&nbsp;</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-CQa9LtKAmFs/W2friZFvbqI/AAAAAAAAGLQ/5VJ4MZGv6bY940KbUBgeQla9JJBliwtgwCLcBGAs/s1600/pcf-2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="954" data-original-width="1600" height="237" src="https://4.bp.blogspot.com/-CQa9LtKAmFs/W2friZFvbqI/AAAAAAAAGLQ/5VJ4MZGv6bY940KbUBgeQla9JJBliwtgwCLcBGAs/s400/pcf-2.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both;">You will update these values ( the storage account ,&nbsp; container name and the key value on the params.yml). See the last section of my sample in the gist.&nbsp;</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-Y_gktyVch-k/W2fsYmlSbDI/AAAAAAAAGLY/-Pn55vY32gYZXk_yNoXxsl-Yr-c3i8-rwCLcBGAs/s1600/pcf-3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="173" data-original-width="1600" height="42" src="https://1.bp.blogspot.com/-Y_gktyVch-k/W2fsYmlSbDI/AAAAAAAAGLY/-Pn55vY32gYZXk_yNoXxsl-Yr-c3i8-rwCLcBGAs/s400/pcf-3.png" width="400" /></a></div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;">Another Pre-req would be the setup of a delegated DNS Zone&nbsp; pointing to the subdomain PCF will reside. For example : my domain for PCF on Azure is : <b>cf.az.clue2solve.com</b> ,&nbsp; with apps domain being apps.cf.az.clue2solve.com and sys being on sys.cf.az.clue2solve.com. I created&nbsp; the new DNS Zone for&nbsp;az.clue2solve.com and created the delegation from my primary DNS provider ( happens to be AWS Route53).&nbsp; See my post on <a href="http://blog.clue2solve.io/2018/07/domain-name-system-dns-delegation-with.html" target="_blank">DNS Delegation</a> for details. This delegation into the Azure DNS&nbsp; is needed&nbsp; as&nbsp; the pipelines create subdomains under the base cf domain and attach them.&nbsp;</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;">Few key items in the params file to be careful when filling are:&nbsp;</div><div class="separator" style="clear: both;"></div><ul><li>The domain names for the ops manager,&nbsp; sys and apps domains.&nbsp;</li><li>The load-balancer name&nbsp;</li><li>pivnet token&nbsp;</li><li>terraform storage info ..</li></ul><div><br /></div><div>Once the parameters file is ready ,&nbsp; we are going to create the pipeline on Concourse.&nbsp;</div><div><pre><code><br /><span style="background-color: #f3f3f3;"><i>anandrao at Anands-MBP in ~/pivotal/repos/pcf-pipelines-023.6-pivnet/install-pcf/azure<br />$ fly -t az  set-pipeline -p install-pcf-az -c pipeline.yml -l params.yml</i></span><br /></code></pre><br />Next ,&nbsp; we will login to the concourse UI and un-pause the pipeline.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-IYrG5_btV5g/W2furFnIWAI/AAAAAAAAGLs/xr3C4eSyO1sgNBVSNIdeYN19semxQzujgCLcBGAs/s1600/pcf-5.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="954" data-original-width="1600" height="237" src="https://1.bp.blogspot.com/-IYrG5_btV5g/W2furFnIWAI/AAAAAAAAGLs/xr3C4eSyO1sgNBVSNIdeYN19semxQzujgCLcBGAs/s400/pcf-5.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-51Fzw6sUIRU/W2fuG5PLxRI/AAAAAAAAGLk/nSJr4Caj5kYwfcY1w_kkmb3dqBQeqDL-gCLcBGAs/s1600/pcf-4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="954" data-original-width="1600" height="237" src="https://4.bp.blogspot.com/-51Fzw6sUIRU/W2fuG5PLxRI/AAAAAAAAGLk/nSJr4Caj5kYwfcY1w_kkmb3dqBQeqDL-gCLcBGAs/s400/pcf-4.png" width="400" /></a></div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;"><br /></div>You may observe that the terraform states will be in error. This is&nbsp; because,&nbsp; all e did in the prep step was to create the container.&nbsp; We now need to initialize the terraform.state file on that container.&nbsp; We don't have to do it manually.&nbsp; This is done via a job on the pipeline called "bootstrap Terraform".<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-0hbzK_fWvAA/W2fvg-fmfOI/AAAAAAAAGL8/M5A6eegUINUxU3j-B_Lz_HFesDOcEUghQCLcBGAs/s1600/pcf-6.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="954" data-original-width="1600" height="237" src="https://4.bp.blogspot.com/-0hbzK_fWvAA/W2fvg-fmfOI/AAAAAAAAGL8/M5A6eegUINUxU3j-B_Lz_HFesDOcEUghQCLcBGAs/s400/pcf-6.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-mRXGETAnMWc/W2fvgwQlTGI/AAAAAAAAGL4/IA2Dvi6ltNokJbZQqg2nhczL1mCjnv-UQCLcBGAs/s1600/pcf-7.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="954" data-original-width="1600" height="237" src="https://2.bp.blogspot.com/-mRXGETAnMWc/W2fvgwQlTGI/AAAAAAAAGL4/IA2Dvi6ltNokJbZQqg2nhczL1mCjnv-UQCLcBGAs/s400/pcf-7.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both;">Once this completed ,&nbsp; should see the terraform state steps in black instead of orange. This tells us we are ready for the next stage.&nbsp;</div><div class="separator" style="clear: both;"><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-XWBEDfEMlKA/W2fwMSJLxSI/AAAAAAAAGMI/8A6YTEbPbnMIRQfCKpu_Bcby1J3BWZsBwCLcBGAs/s1600/pcf-8.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="954" data-original-width="1600" height="237" src="https://4.bp.blogspot.com/-XWBEDfEMlKA/W2fwMSJLxSI/AAAAAAAAGMI/8A6YTEbPbnMIRQfCKpu_Bcby1J3BWZsBwCLcBGAs/s400/pcf-8.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;">Now its time to let it all Fly through the pipeline. Click into the "create-infrastrucutre" step and then the plus button there to initiate it. the Dotted lines between Jobs tells that they are not auto triggered and thus,&nbsp; this step has&nbsp; to be manually triggered. All subsequet jobs are automatically triggered when the prior dependencies are met.&nbsp;</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-s5XPxDZfiWg/W2fwMQPap1I/AAAAAAAAGMM/KiFlg_W6FEEHYaicWOazZnpiUv1KA3zVACLcBGAs/s1600/pcf-9.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: left;"><img border="0" data-original-height="954" data-original-width="1600" height="237" src="https://3.bp.blogspot.com/-s5XPxDZfiWg/W2fwMQPap1I/AAAAAAAAGMM/KiFlg_W6FEEHYaicWOazZnpiUv1KA3zVACLcBGAs/s400/pcf-9.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-SmclC1WhDhw/W2fxRjixVuI/AAAAAAAAGMc/w0Mo5L6YBwEs7PLPQCrPLEV6VMYUWZvpACLcBGAs/s1600/pcf-11.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="960" data-original-width="1600" height="238" src="https://1.bp.blogspot.com/-SmclC1WhDhw/W2fxRjixVuI/AAAAAAAAGMc/w0Mo5L6YBwEs7PLPQCrPLEV6VMYUWZvpACLcBGAs/s400/pcf-11.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-HTcSEEPMA9w/W2fxRtsRtXI/AAAAAAAAGMk/NmkRycQJMOA2Gqerj_sIPst3gdXjgC-PwCLcBGAs/s1600/pcf-12.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="960" data-original-width="1600" height="238" src="https://2.bp.blogspot.com/-HTcSEEPMA9w/W2fxRtsRtXI/AAAAAAAAGMk/NmkRycQJMOA2Gqerj_sIPst3gdXjgC-PwCLcBGAs/s400/pcf-12.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-S59vAYspIao/W2fxRo4dlxI/AAAAAAAAGMg/IFbNnDYacrcf_u0-d0X6cnQGah_4UsquACLcBGAs/s1600/pcf-10.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="960" data-original-width="1600" height="238" src="https://4.bp.blogspot.com/-S59vAYspIao/W2fxRo4dlxI/AAAAAAAAGMg/IFbNnDYacrcf_u0-d0X6cnQGah_4UsquACLcBGAs/s400/pcf-10.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><br /><br /></div>After seeing green on every stage ,&nbsp; you should now be able to login to the ops manager using the ops manager url as below.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-7LU-oVD7Xyw/W2fyIBU1qEI/AAAAAAAAGM0/LLTfKgG3we4UJ_odmeTl3KpqVEqaJhQiACLcBGAs/s1600/pcf-13.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1279" data-original-width="1600" height="318" src="https://3.bp.blogspot.com/-7LU-oVD7Xyw/W2fyIBU1qEI/AAAAAAAAGM0/LLTfKgG3we4UJ_odmeTl3KpqVEqaJhQiACLcBGAs/s400/pcf-13.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both;">Congratulations ,&nbsp; you now have a cloud Foundry installation ready to use.&nbsp; Let me walk you through some basic sample apps deployment into this foundation to wrap up the install process in another blog entry.&nbsp;</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;">Don't forget to read my post on the cleanup of PCF if you are into playing with these installations for short durations.&nbsp; Links is below.&nbsp;</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;">Quick links to the "The PCF on Azure" Blog Series :&nbsp;</div><ul><li><a href="http://blog.clue2solve.io/2018/07/installing-pcf-2x-on-azure-using.html">Installing PCF 2.X on Azure using Concourse - Part - 1 , Bosh Boot loader and bosh</a></li><li><a href="http://blog.clue2solve.io/2018/07/installing-pcf-2x-on-azure-using_31.html">Installing PCF 2.X on Azure using Concourse - Part - 2 , Concourse using bosh</a></li><li><a href="http://blog.clue2solve.io/2018/08/installing-pcf-2x-on-azure-using.html">Installing PCF 2.X on Azure using Concourse - Part - 3 , Installing Pivotal Cloud Foundry using a Pipeline</a></li><li><a href="http://blog.clue2solve.io/2018/07/domain-name-system-dns-delegation-with.html">Domain Name System (DNS) Delegation with Azure DNS Zones</a></li><li><a href="http://blog.clue2solve.io/2018/08/cleanup-azure-pcf-install-using-bbl.html">Cleanup Azure PCF install using BBL</a></li></ul><div class="separator" style="clear: both;"><br /></div><div><br /></div><br />